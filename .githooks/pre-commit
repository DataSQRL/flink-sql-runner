#!/bin/sh
set -eu

# Run Spotless only when relevant files are staged.
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR || true)

echo "$STAGED_FILES" | grep -Eq '(\.java$|(^|/)pom\.xml$)' || exit 0

if [ -x "./mvnw" ]; then
  MVN="./mvnw"
else
  MVN="mvn"
fi

$MVN -q -DskipTests spotless:apply

# Re-stage whatever was already staged.
# Use -z to handle filenames with spaces.
git diff --cached --name-only -z --diff-filter=ACMR | xargs -0 git add --
